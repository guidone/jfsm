{"note":"Don't delete this file! It's used internally to help with page regeneration.","google":"","tagline":"jQuery Finite State Machine","body":"jQuery Finite State Machine\r\n===========================\r\n\r\n**jfsm** stands for jQuery Finite State Machine and it's a little script to help handling UI controls passing from a state to another.\r\n\r\n## An example\r\nHave you ever found yourself in a situation writing code like this?\r\n\r\n\t$('a.button1')\r\n\t\t.click(function() {\r\n\t\t\t// go to step2\r\n\t\t\t$('a.letsGoBack').show();\r\n\t\t\t$('a.button1').hide();\r\n\t\t\t$('a.button2').show();\r\n\t\t\t}); \t\r\n\t$('a.button2')\r\n\t\t.click(function() {\r\n\t\t\t// go to step3\r\n\t\t\t$('a.letsGoBack').show();\r\n\t\t\t$('a.button1').hide();\r\n\t\t\t$('a.button2').hide();\r\n\t\t\t$('a.save').show();\r\n\t\t\t$('.controlToDisableInStep3').addClass('disabled');\r\n\t\t\t});\r\n\r\nIn this script some controls must be visible and enabled in a state (for example step #1 of a wizard) and/or invisible in the next state.\r\nNothing wrong with the code above, but as soon as the complexity of the UI grows up, the code become un-mantainable.\r\n\r\nWouldn't be easier to define a set of possible states for our UI (for example step1, step2 and step3 for our multistep form) and define for each of them the behaviour of the UI components\r\n\r\n\t$('a.button1')\r\n\t\t.jfsm('step1',{visible: true})\r\n\t\t.jfsm('step2',{visible: false})\r\n\t\t.jfsm('step3',{visible: false});\r\n\t$('a.button2')\r\n\t\t.jfsm('step1',{visible: false})\r\n\t\t.jfsm('step2',{visible: true})\r\n\t\t.jfsm('step3',{visible: false}); \t\t\r\n\t$('a.save')\r\n\t\t.jfsm('step1',{visible: false})\r\n\t\t.jfsm('step2',{visible: false})\r\n\t\t.jfsm('step3',{visible: true});\r\n\t$('a.letsGoBack')\r\n\t\t.jfsm('step1',{visible: false})\r\n\t\t.jfsm('step2',{visible: true})\r\n\t\t.jfsm('step3',{visible: true});\r\n\t$('.controlToDisableInStep3')\r\n\t\t.jfsm('step3',{className: 'disabled'});\r\n\r\nThen with a simple command we change the state *$.jfsm('step3')* and it will do the magic for you: *.button2* and *.button1* are hidden, *.save* and .letsGoBack are visible and the control .controlToDisableInStep3 gains the class 'disabled'.\r\nAt first sight seems I've written more code, perhaps it's true, but I've grouped this kind of logic in just one place and it's easier to add element to the UI.\r\n\r\n## Syntax\r\n- $('element-selector').jfsm('mystate',<state-descriptor>);\r\nDefine a descriptor for an element on the state 'mystate'. The descriptor is an hash array which may contains one or more of these keys:\r\n\t* visible (true| false): make this element visibile or hidden in the defined state. The default is true (means that in any other state, if not specified, the element is visible)\r\n\t* className: assign a CCS class to the element in the defined state\r\n\t* click: assign a click handler for the element in the defined state (how did I do before this? Checking the state of the UI inside the click handler? Naaaa)\r\nIt's possible to register your own key in the descriptor, see below.\r\n- $.jfsm('to-state');\r\nChange the state the to 'to-state', triggering all the UI changes defined with the function above.\r\nIt always return a Deferred() object since the changes to the UI might be asynchronous.\r\n\t$.jfsm('to-state')\r\n\t\t.done(function() {\r\n\t\t\t// ta da\r\n\t\t\t});\r\nIn addition, when a transition is completed, an event 'jfsm-state' is triggered on $\t('body'), the first argument is the new state name.\r\n- $.jfsm(new_descriptor,descriptor_handler,predefined_value);\r\nDefine a new key for the state descriptor object\r\n* new_descriptor(string): a string representing the key in the state descriptor\r\n* descriptor_handler(function): the handler that operates the changes on the UI. The context (this) is the UI element to be changed, accepts two parameters f(from,to) which are the values of the key in the previous and new state, respectively (if these two values are the same in the transition, the handler will not be called).\r\nSee the example below about defining a new descriptor\r\n* predefined_value(anything|function): defines which is the default value of the field in the state descriptor\r\n\t* new_descriptor(string): a string representing the key in the state descriptor\r\n\t* descriptor_handler(function): the handler that operates the changes on the UI. The context (this) is the UI element to be changed, accepts two parameters f(from,to) which are the values of the key in the previous and new state, respectively (if these two values are the same in the transition, the handler will not be called).\r\n\tSee the example below about defining a new descriptor\r\n\t* predefined_value(anything|function): defines which is the default value of the field in the state descriptor\r\n\r\n# Adding a fadeout descriptor\r\n\r\nSuppose I want to hide/show elements during transition using a fancy fade in/out effect.\r\nFirst of all, register the *fade* key for the state descriptor:\r\n\r\n\t$.jfsm(\r\n\t\t'fade',\r\n\t\tfunction(from,to) {\r\n\t\t\tto = !!to; // to be sure is true or false\r\n\t\t\tif (to) \r\n\t\t\t\t$(this).fadeIn();\r\n\t\t\telse $(this).fadeOut(); \r\n\t\t\t},\r\n\t\ttrue\r\n\t\t); \r\n\r\nThen define the behaviour of the button\r\n\r\n\t$('a.button1')\r\n\t\t.jfsm('step1',{fade: true})\r\n\t\t.jfsm('step2',{fade: false});\r\n\r\nAnd now *$.jfsm('step1')* and *$.jfsm('step2')* will switch the state between *step1* and *step2*, happily fading in and out your button.\r\nBut we can do even better, jfsm handles correctly deferred objects, we can improve the handler in this way:\r\n\r\n\t$.jfsm(\r\n\t\t'fade',\r\n\t\tfunction(from,to) {\r\n\t\t\tto = !!to; // to be sure is true or false\r\n\t\t\tvar deferred = $.Deferred();\r\n\t\t\tif (to) \r\n\t\t\t\t$(this).fadeIn(function() { deferred.resolve(); });\r\n\t\t\telse $(this).fadeOut( function() { deferred.resolve(); }); \r\n\t\t\treturn deferred.promise();\r\n\t\t\t},\r\n\t\ttrue\r\n\t\t); \t\r\n\r\nThe event *'jfsm-state'* will be triggerd only when the fade transition is completed, or I can just use the deferred object returned by $.jfsm:\r\n\r\n\t$.jfsm('step1')\r\n\t\t.done(function() {\r\n\t\t\t// done fading\r\n\t\t\t});","name":"jFsm"}